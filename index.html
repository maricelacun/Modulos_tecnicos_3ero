<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Aula Virtual M√°gica</title>

  <!-- CDN Firebase v8 -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

  <script>
    // ============================
    // CONFIGURACI√ìN FIREBASE v8
    // ============================
    const firebaseConfig = {
      apiKey: "AIzaSyDMZHxCilms5wdCxlgelZGJbyzi9NsWS9E",
      authDomain: "aula-virtual-1c360.firebaseapp.com",
      databaseURL: "https://aula-virtual-1c360-default-rtdb.firebaseio.com",
      projectId: "aula-virtual-1c360",
      storageBucket: "aula-virtual-1c360.firebasestorage.app",
      messagingSenderId: "713777134536",
      appId: "1:713777134536:web:4d536c21a3adaad2b09efd",
      measurementId: "G-29BMZFSQH8"
    };

    // Inicializar Firebase (v8)
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // L√≥gica de DOM / login
    document.addEventListener("DOMContentLoaded", function() {
      const loginBtn = document.getElementById('login-btn');
      const errorMessage = document.getElementById('error-message');

      if (!loginBtn) {
        console.error("El bot√≥n de login no se encuentra en el DOM.");
        return;
      }

      loginBtn.addEventListener('click', async function (event) {
        event.preventDefault();

        const usuario = document.getElementById('usuario').value.trim();
        const clave = document.getElementById('clave').value.trim();

        // Validaciones simples
        if (!usuario || !clave) {
          errorMessage.innerText = "Por favor, ingresa un usuario y una clave";
          errorMessage.style.display = "block";
          return;
        } else {
          errorMessage.style.display = "none";
        }

        try {
          // Consulta a Firestore: colecci√≥n "estudiantes" campo "usuario"
          const querySnapshot = await db.collection("estudiantes").where("usuario", "==", usuario).get();

          if (querySnapshot.empty) {
            errorMessage.innerText = "Usuario no encontrado";
            errorMessage.style.display = "block";
            return;
          }

          let encontrado = false;
          querySnapshot.forEach((doc) => {
            const data = doc.data();
            console.log("Datos obtenidos:", data);

            // Comparar credenciales (ajusta campo si tu clave est√° en otro campo)
            if (String(data.id_est).trim() === String(clave).trim()) {
              localStorage.setItem("nombreEstudiante", data.nombres_completos || data.nombres || "");
              localStorage.setItem("accesoPermitido", "true");
              encontrado = true;
            }
          });

          if (encontrado) {
            // Redirigir fuera del try/catch para mayor claridad
            window.location.href = "aula.html";
          } else {
            errorMessage.innerText = "Clave incorrecta";
            errorMessage.style.display = "block";
          }
        } catch (error) {
          console.error("Error en la autenticaci√≥n:", error);
          errorMessage.innerText = "Ocurri√≥ un error en la autenticaci√≥n (revisa consola)";
          errorMessage.style.display = "block";
        }
      });
    });
  </script>

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-image: url('https://i.pinimg.com/originals/40/06/c8/4006c8cff8b054ca07741fda848d89a8.gif');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      color: white;
      text-align: center;
      padding: 50px;
      margin: 0;
    }

    #login-container, #welcome-container {
      background-image: url('https://i.makeagif.com/media/4-19-2017/gLpcy_.gif');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      padding: 20px;
      border-radius: 25px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      display: inline-block;
      width: 100%;
      max-width: 600px;
      box-sizing: border-box;
    }

    input[type="text"], input[type="password"] {
      width: 150px;
      padding: 14px;
      font-size: 15px;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin-right: 10px;
      box-sizing: border-box;
    }

    button {
      width: auto;
      padding: 10px 15px;
      font-size: 15px;
      border-radius: 8px;
      background-color: #FFD700;
      color: black;
      border: none;
      cursor: pointer;
    }

    button:hover {
      background-color: #FFC107;
    }

    #error-message {
      color: #ffb3b3;
      margin-top: 12px;
      display: none;
    }

    /* Responsive */
    @media (max-width: 480px) {
      input[type="text"], input[type="password"] {
        width: 100%;
        margin: 8px 0;
      }
      #login-container { padding: 16px; }
    }
  </style>
</head>

<body>
  <div id="login-container" role="main" aria-labelledby="titulo-sitio">
    <img src="sello.jpg" alt="Sello institucional" id="sello" style="width:150px;height:auto;margin-top:20px;">
    <h2 id="titulo-sitio">üîÆ UNIDAD EDUCATIVA "DR. CAMILO GALLEGOS DOM√çNGUEZ" ‚ú®</h2>
    <h3>üîÆ Bienvenido (a) a nuestra Aula Virtual ‚ú®</h3>

    <div style="margin-top:12px;">
      <input type="text" id="usuario" placeholder="Ingresa tu usuario" aria-label="Usuario">
      <input type="password" id="clave" placeholder="Ingresa tu clave" aria-label="Clave">
    </div>

    <div style="margin-top:12px;">
      <button id="login-btn">Ingresar üîë</button>
    </div>

    <p id="error-message">Usuario o clave incorrecta. Intenta de nuevo.</p>

    <img src="piclumen-1743471294593.png" alt="Robot" id="robot" style="width:300px;height:auto;margin-top:20px;">
  </div>

  <div id="welcome-container" style="display:none;">
    <h2>üéâ Bienvenido, <span id="nombre"></span>! üöÄ</h2>
    <button id="continue-btn">Explorar Aula Virtual üè´</button>
  </div>
</body>
</html>
